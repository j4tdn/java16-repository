CREATE DATABASE JAVA16_LESSON18_EXAM CHAR SET UTF8MB4;
USE JAVA16_LESSON18_EXAM;

CREATE TABLE CLASS
(
    ID      INT PRIMARY KEY,
    NAME    VARCHAR(200),
    TEACHER VARCHAR(200)

);
CREATE TABLE STUDENT
(
    ID       INT PRIMARY KEY,
    NAME     VARCHAR(200),
    GENDER   VARCHAR(200),
    CLASS_ID INT,
    CONSTRAINT FK_STUDENT_CLASS FOREIGN KEY (CLASS_ID) REFERENCES CLASS (ID)
);
CREATE TABLE RESULT
(
    STUDENT_ID INT,
    SUBJECT    VARCHAR(200),
    SCORE      DOUBLE,
    CONSTRAINT PK_CTDH PRIMARY KEY (STUDENT_ID, SUBJECT),
    CONSTRAINT FK_STUDENT_RESULT FOREIGN KEY (STUDENT_ID) REFERENCES STUDENT (ID)
);
INSERT INTO CLASS(ID, NAME, TEACHER)
VALUES (1, "12A", "Tran Nhat Minh");
INSERT INTO CLASS(ID, NAME, TEACHER)
VALUES (2, "12B", "Tran Ngoc Minh");
INSERT INTO CLASS(ID, NAME, TEACHER)
VALUES (3, "12C", "Nguyen Tien Minh");

INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
VALUES (1, "NVA", "Female", 2);
INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
VALUES (2, "NVB", "Female", 1);
INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
VALUES (3, "NVC", "Male", 2);
INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
VALUES (4, "NVD", "Female", 1);
INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
VALUES (5, "NVE", "Male", 3);
INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
VALUES (6, "NVF", "Female", 3);

INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (1, "Math", 8);
INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (1, "Literature", 9);
INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (2, "Literature", 7);
INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (3, "History", 5);
INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (4, "Math", 8);
INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (5, "Literature", 6);
INSERT INTO RESULT(STUDENT_ID, SUBJECT, SCORE)
VALUES (6, "History", 9);



-- QUESTION 1

-- Primary key of result table is student_id and subject

-- QUESTION 2

SELECT ST.NAME, ST.GENDER, CLASS.TEACHER
FROM STUDENT ST
         JOIN CLASS
              ON ST.CLASS_ID = CLASS.ID;

-- QUESTION 3

SELECT CLASS.TEACHER, count(*)
FROM STUDENT ST
         JOIN CLASS
              ON ST.CLASS_ID = CLASS.ID
WHERE CLASS.NAME = "12C";

-- QUESTION 4

SELECT CLASS.ID, CLASS.NAME, count(STUDENT.ID)
FROM STUDENT
         JOIN CLASS ON STUDENT.CLASS_ID = CLASS.ID
         JOIN RESULT ON RESULT.STUDENT_ID = STUDENT.ID
WHERE RESULT.SUBJECT = "Literature" AND RESULT.SCORE >= 8.0 AND EXISTS(SELECT *
FROM STUDENT ST_TEMP
         JOIN CLASS CL_TEMP ON ST_TEMP.CLASS_ID = CL_TEMP.ID
         JOIN RESULT RS_TEMP ON ST_TEMP.ID = RS_TEMP.STUDENT_ID
WHERE RS_TEMP.SUBJECT = "Math" AND RS_TEMP.SCORE >= 8.0 AND STUDENT.ID = ST_TEMP.ID)
GROUP BY CLASS.ID;



