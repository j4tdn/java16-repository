CREATE DATABASE java16_lesson18_nhattan;

USE java16_lesson18_nhattan;

CREATE TABLE CLASS(
	ID INT,
    `NAME` VARCHAR(50),
    TEACHER VARCHAR(50),
    CONSTRAINT PK_CLASS PRIMARY KEY (ID)
);

CREATE TABLE STUDENT (
	ID INT,
	NAME VARCHAR(255) NOT NULL,
	GENDER VARCHAR(10) NOT NULL,
    CLASS_ID INT NOT NULL,
    CONSTRAINT PK_STUDENT PRIMARY KEY (ID),
    CONSTRAINT FK_STUDENT_CLASS FOREIGN KEY (CLASS_ID) REFERENCES CLASS(ID)
);

CREATE TABLE RESULT (
    STUDENT_ID INT,
    `SUBJECT` VARCHAR(50),
    SCORE DOUBLE NOT NULL,
    CONSTRAINT PK_RESULT PRIMARY KEY (STUDENT_ID, `SUBJECT`), 
    CONSTRAINT FK_STUDENT_RESULT FOREIGN KEY (STUDENT_ID) REFERENCES STUDENT(ID)
);

INSERT INTO CLASS (ID, NAME, TEACHER) 
values(1,"12A","Ho Cong Tung "),
	  (2,"12B","Ho Cong Tap "),
	  (3,"12C","Ho Cong Teo ");
      
INSERT INTO STUDENT(ID, NAME, GENDER, CLASS_ID)
values (1, 'Dinh Thi Ngoc', 'Female', 2),
		(2, 'Nguyen Thanh Hung', 'Male', 1),
        (3, 'Tran Mai Hoa', 'Female', 2),
		(4, 'Doan Quang Vinh', 'Male', 1),
        (5, 'Cao Anh Dao', 'Female', 3),
		(6, 'Tran Kim Tuyen', 'Female', 3);
        
INSERT INTO RESULT(STUDENT_ID, `SUBJECT`, SCORE)
VALUES (1, 'Math', 8),
	   (2, 'Literature', 7),
       (3, 'History', 9.5),
       (4, 'Math', 6.8),
       (5, 'Literature', 4.9),
       (6, 'History', 8.2);
       
-- 1. PRIMARY OF RESULT TABLE (STUDENT_ID, SUBJECT)

-- 2. 
SELECT st.NAME,
	   st.GENDER,
       cl.TEACHER 
  FROM STUDENT st
  JOIN CLASS cl
	ON st.CLASS_ID = cl.ID;

-- 3
SELECT cl.TEACHER,
	   COUNT(st.ID) ToTalStudent
  FROM STUDENT st
  JOIN CLASS cl
	ON st.CLASS_ID = cl.ID
 WHERE cl.NAME = '12C'
 GROUP BY cl.TEACHER;

-- 4
SELECT CLASS.NAME, 
       COUNT(STUDENT.ID) GOOD_AT_MATH_LITERATURE
  FROM CLASS
  JOIN STUDENT ON STUDENT.CLASS_ID = CLASS.ID
  JOIN RESULT ON STUDENT.ID = RESULT.STUDENT_ID
 WHERE RESULT.SUBJECT = 'Math' OR RESULT.SUBJECT = 'Literature' 
   AND RESULT.SCORE >= 8
 GROUP BY CLASS.ID;

SELECT CLASS.NAME, 
       COUNT(STUDENT.ID) GOOD_AT_MATH_LITERATURE
  FROM CLASS
  JOIN STUDENT ON STUDENT.CLASS_ID = CLASS.ID
  JOIN RESULT ON STUDENT.ID = RESULT.STUDENT_ID
 WHERE RESULT.SUBJECT = 'Math' OR RESULT.SUBJECT = 'Literature' 
   AND RESULT.SCORE >= 8
 GROUP BY CLASS.ID;
 